<!-- doctorDashboard.html
     Doctor Dashboard interface for viewing & managing patient appointments and prescriptions.
     Header & footer are injected dynamically. Appointment data loaded via doctorDashboard.js (module).
-->
<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <!-- Meta -->
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0" />
    <title>Doctor Dashboard | Hospital CMS</title>

    <!-- Favicon -->
    <link rel="icon" type="image/png" th:href="@{/assets/images/logo/logo.png}" href="../assets/images/logo/logo.png" />

    <!-- Stylesheets (order: base/global → shared dashboard → doctor specific) -->
    <link rel="stylesheet" th:href="@{/assets/css/style.css}" href="../assets/css/style.css" />
    <link rel="stylesheet" th:href="@{/assets/css/adminDashboard.css}" href="../assets/css/adminDashboard.css" />
    <link rel="stylesheet" th:href="@{/assets/css/doctorDashboard.css}" href="../assets/css/doctorDashboard.css" />

    <!-- Utility / Core Scripts -->
    <script th:src="@{/js/util.js}" src="../js/util.js" defer></script>
    <script th:src="@{/js/render.js}" src="../js/render.js" defer></script>

    <!-- Shared Components -->
    <script th:src="@{/js/components/header.js}" src="../js/components/header.js" type="module" defer></script>
    <script th:src="@{/js/components/footer.js}" src="../js/components/footer.js" type="module" defer></script>
    <script th:src="@{/js/components/modals.js}" src="../js/components/modals.js" type="module" defer></script>
    <script th:src="@{/js/components/loginHandlers.js}" src="../js/components/loginHandlers.js" type="module" defer></script>

    <!-- Services / Components (appointments & patient rows) -->
    <script th:src="@{/js/services/appointmentServices.js}" src="../js/services/appointmentServices.js" type="module" defer></script>
    <script th:src="@{/js/components/patientRow.js}" src="../js/components/patientRow.js" type="module" defer></script>
    <script th:src="@{/js/components/appointmentRow.js}" src="../js/components/appointmentRow.js" type="module" defer></script>

    <!-- Page Logic -->
    <script th:src="@{/js/pages/doctorDashboard.js}" src="../js/pages/doctorDashboard.js" type="module" defer></script>

    <!-- (Optional) Appointments generic logic (if reused) -->
    <script th:src="@{/js/pages/appointments.js}" src="../js/pages/appointments.js" type="module" defer></script>
</head>
<body>
<div class="container doctor-dashboard-container">
    <div class="wrapper">

        <!-- Header Placeholder -->
        <div id="header"></div>

        <!-- Main Content -->
        <main class="main-content" id="mainContent" tabindex="-1" aria-labelledby="doctorDashboardTitle">
            <header class="page-header">
                <h1 id="doctorDashboardTitle">Doctor Dashboard</h1>
                <p class="page-subtitle">Review today’s appointments, search patients, and access prescriptions.</p>
            </header>

            <!-- Search & Filters -->
            <section class="controls" aria-label="Appointment Filters">
                <div class="search-group">
                    <label for="searchBar" class="visually-hidden">Search Patient</label>
                    <!-- Primary search input (as per spec) -->
                    <input
                            type="text"
                            id="searchBar"
                            class="search-input"
                            placeholder="Search patients..."
                            autocomplete="off"
                            aria-label="Search patients by name"
                    />
                    <!-- Alias for shared appointments.js (patientSearch) -->
                    <input
                            type="hidden"
                            id="patientSearch"
                    />
                </div>

                <div class="filter-group">
                    <label for="datePicker">Select Date</label>
                    <input
                            type="date"
                            id="datePicker"
                            class="date-input"
                            aria-label="Select appointment date"
                    />
                    <!-- Alias for shared script compatibility -->
                    <input type="hidden" id="appointmentDate" />
                </div>

                <div class="filter-group">
                    <button type="button" id="todayButton" class="btn btn-secondary" aria-label="Jump to today's appointments">
                        Today
                    </button>
                    <!-- Alias ID for shared script compatibility -->
                    <button type="button" id="todayBtn" class="btn btn-secondary alias-button visually-hidden" tabindex="-1" aria-hidden="true">
                        Today
                    </button>
                </div>
            </section>

            <!-- Appointments / Patients Table -->
            <section class="appointments-section" aria-label="Patient Appointments">
                <div class="table-responsive">
                    <table class="data-table appointments-table" aria-describedby="appointmentsCaption">
                        <caption id="appointmentsCaption" class="visually-hidden">
                            Patient appointment list with prescription access.
                        </caption>
                        <thead>
                        <tr>
                            <th scope="col">Patient ID</th>
                            <th scope="col">Name</th>
                            <th scope="col">Phone No.</th>
                            <th scope="col">Email</th>
                            <th scope="col">Prescription</th>
                        </tr>
                        </thead>
                        <tbody id="patientTableBody">
                        <!-- Doctor-specific dynamic rows -->
                        </tbody>
                        <!-- Alias tbody for appointments.js (if reused) -->
                        <tbody id="appointmentsTbody" class="visually-hidden"></tbody>
                    </table>
                </div>
            </section>

            <!-- Additional Panels (optional placeholders) -->
            <section id="extraPanels" hidden></section>
        </main>

        <!-- Footer Placeholder -->
        <div id="footer"></div>

    </div>
</div>

<!-- Shared Modal (login, prescription, etc.) -->
<div id="modal" class="modal" aria-hidden="true" style="display:none;">
    <div class="modal-overlay" data-close="true"></div>
    <div class="modal-dialog" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
        <button id="closeModal" class="modal-close" aria-label="Close">&times;</button>
        <div id="modal-body" class="modal-body"><!-- Dynamic modal content injected here --></div>
    </div>
</div>

<!-- Inline Enhancements -->
<script type="module">
    // Accessibility: focus main after DOM ready
    window.addEventListener("DOMContentLoaded", () => {
      document.getElementById("mainContent")?.focus();

      // Mirror primary search into hidden alias for shared script, if needed
      const primarySearch = document.getElementById("searchBar");
      const aliasSearch = document.getElementById("patientSearch");
      if (primarySearch && aliasSearch) {
        primarySearch.addEventListener("input", () => {
          aliasSearch.value = primarySearch.value;
          // If a shared loadAppointments function exists, invoke it
          if (typeof window.loadAppointments === "function") {
            window.loadAppointments();
          }
        });
      }

      // Sync date inputs if both exist
      const datePicker = document.getElementById("datePicker");
      const aliasDate = document.getElementById("appointmentDate");
      if (datePicker && aliasDate) {
        datePicker.addEventListener("change", () => {
          aliasDate.value = datePicker.value;
          if (typeof window.loadAppointments === "function") {
            window.loadAppointments();
          }
        });
      }

      // Today buttons
      const todayBtn = document.getElementById("todayButton");
      const aliasToday = document.getElementById("todayBtn");
      todayBtn?.addEventListener("click", () => {
        const today = new Date();
        const iso = new Date(today.getTime() - today.getTimezoneOffset() * 60000)
          .toISOString()
          .slice(0, 10);
        if (datePicker) datePicker.value = iso;
        if (aliasDate) aliasDate.value = iso;
        if (typeof window.loadAppointments === "function") {
          window.loadAppointments();
        }
      });
      aliasToday?.addEventListener("click", () => todayBtn?.click());
    });
</script>
</body>
</html>